<%= form_with(model: family, class: "contents max-w-4xl mx-auto") do |form| %>
  <% if family.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-lg mt-3">
      <h2><%= pluralize(family.errors.count, "error") %> prohibited this family from being saved:</h2>

      <ul>
        <% family.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="bg-white p-6 rounded-lg shadow-sm">
    <h3 class="text-lg font-semibold text-gray-700 mb-4">Contato e localização</h3>
    
    <div class="space-y-6">
      <div>
        <%= form.label :reference_name, "Nome de Referência Identificador", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :reference_name, 
            class: "block w-full max-w-2xl shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
            placeholder: "Exemplo: casa de dona Nina, família da Maria, etc." %>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= form.label :phone1, "Telefone 1", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :phone1, 
              class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
              placeholder: "(XX) X XXXX-XXXX",
              data: { controller: "phone-mask" } %>
        </div>

        <div>
          <%= form.label :phone2, "Telefone 2", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :phone2, 
              class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
              placeholder: "(XX) X XXXX-XXXX",
              data: { controller: "phone-mask" } %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
        <div class="md:col-span-5">
          <%= form.label :street, "Rua", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :street, class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>

        <div class="md:col-span-1">
          <%= form.label :house_number, "Número", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :house_number, class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= form.label :city, "Cidade", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :city, value: "Vitória da Conquista", 
              class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>

        <div>
          <%= form.label :state, "Estado", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :state, value: "Bahia", 
              class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>
      </div>
    </div>

    <h3 class="text-lg font-semibold text-gray-700 mt-8 mb-4">Membros</h3>
    
    <div id="members" class="space-y-4">
      <div id="member_fields">
        <%= form.fields_for :members do |member_form| %>
          <%= render 'member_fields', f: member_form %>
        <% end %>
      </div>
      
      <div class="flex justify-end mt-4">
        <%= link_to_add_association 'Adicionar novo membro', form, :members, 
            class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
            data: { 
              association_insertion_node: '#member_fields', 
              association_insertion_method: 'append' 
            } %>
      </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-sm mt-6">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Informações de Moradia e Financeiras</h3>
      
      <div class="space-y-6">
        <div class="mb-6">
          <%= form.label :neighborhood, "Bairro", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :neighborhood, class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <%= form.label :housing_type, "Tipo de moradia", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <div class="space-x-6">
              <%= form.radio_button :housing_type, 'own', class: "mr-2 rounded-full border-gray-300" %>
              <%= form.label :housing_type_own, "Casa própria", class: "mr-4 text-sm text-gray-700" %>
              
              <%= form.radio_button :housing_type, 'rented', class: "mr-2 rounded-full border-gray-300" %>
              <%= form.label :housing_type_rented, "Casa alugada", class: "text-sm text-gray-700" %>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <%= form.label :financing_value, "Valor do financiamento", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.number_field :financing_value, step: '0.01', 
                class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
                  <div>
                  <%= form.label :financed_house, class: "block text-sm font-medium text-gray-700 mb-2" do %>
                    <%= form.check_box :financed_house, class: "mr-2 rounded border-gray-300" %>
                    Casa financiada?
                  <% end %>
                </div>
            </div>

          <div>
            <%= form.label :rent_value, "Valor do aluguel", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.number_field :rent_value, step: '0.01', 
                class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
          </div>

          <div>
            <%= form.label :family_income, "Renda familiar", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.number_field :family_income, step: '0.01', 
                class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-sm mt-6">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Informações da Cesta Básica</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= form.label :food_basket_start_date, "Data de início da cesta básica", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.date_field :food_basket_start_date, class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>

        <div>
          <%= form.label :food_basket_duration_months, "Tempo liberado (meses)", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.number_field :food_basket_duration_months, class: "block w-full shadow-sm rounded-md border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        </div>
      </div>
    </div>

    <div class="mt-8">
      <%= form.submit t('actions.update.family'), 
          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
    </div>
  </div>
<% end %>

<style>
.member-container {
    background-color: #f0f4f8;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
}
</style>
